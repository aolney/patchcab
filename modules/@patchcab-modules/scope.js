import{Faceplate as e,onMount as t,Knob as n,Switch as s,Patch as o,scale as _}from"https://olney.ai/patchcab/js/core.js";function i(e){__sv.append_styles(e,"svelte-hejow9","canvas.svelte-hejow9{background:#232d30;position:absolute;left:15px;top:60px;width:160px;height:180px}")}function r(e){let t,_,i,r,l,a,v,c,g;function p(t){e[6](t)}let m={size:"s",label:"level",x:72,y:254,min:-.9,max:.9,precision:2};return void 0!==e[0].level&&(m.value=e[0].level),i=new n({props:m}),__sv.binding_callbacks.push((()=>__sv.bind(i,"value",p))),a=new s({props:{square:!0,label:"trigger",x:23,y:264,value:e[0].trigger,onToggle:e[4]}}),c=new o({props:{label:"in",x:84,y:325,name:"audio-1",input:e[2],onConnect:e[3]}}),{c(){t=__sv.element("canvas"),_=__sv.space(),__sv.create_component(i.$$.fragment),l=__sv.space(),__sv.create_component(a.$$.fragment),v=__sv.space(),__sv.create_component(c.$$.fragment),__sv.attr(t,"class","svelte-hejow9")},m(n,s){__sv.insert(n,t,s),e[5](t),__sv.insert(n,_,s),__sv.mount_component(i,n,s),__sv.insert(n,l,s),__sv.mount_component(a,n,s),__sv.insert(n,v,s),__sv.mount_component(c,n,s),g=!0},p(e,t){const n={};!r&&1&t&&(r=!0,n.value=e[0].level,__sv.add_flush_callback((()=>r=!1))),i.$set(n);const s={};1&t&&(s.value=e[0].trigger),a.$set(s)},i(e){g||(__sv.transition_in(i.$$.fragment,e),__sv.transition_in(a.$$.fragment,e),__sv.transition_in(c.$$.fragment,e),g=!0)},o(e){__sv.transition_out(i.$$.fragment,e),__sv.transition_out(a.$$.fragment,e),__sv.transition_out(c.$$.fragment,e),g=!1},d(n){n&&__sv.detach(t),e[5](null),n&&__sv.detach(_),__sv.destroy_component(i,n),n&&__sv.detach(l),__sv.destroy_component(a,n),n&&__sv.detach(v),__sv.destroy_component(c,n)}}}function l(t){let n,s;return n=new e({props:{title:"SCOPE",color:"var(--color-3)",$$slots:{default:[r]},$$scope:{ctx:t}}}),{c(){__sv.create_component(n.$$.fragment)},m(e,t){__sv.mount_component(n,e,t),s=!0},p(e,[t]){const s={};32771&t&&(s.$$scope={dirty:t,ctx:e}),n.$set(s)},i(e){s||(__sv.transition_in(n.$$.fragment,e),s=!0)},o(e){__sv.transition_out(n.$$.fragment,e),s=!1},d(e){__sv.destroy_component(n,e)}}}function a(e,n,s){let o,i,r=new Tone.Waveform(512),l=!1;const a=window.devicePixelRatio||1,v=160*a,c=180*a,g=20*a;let{state:p={trigger:!1,level:0,holdoff:1}}=n;const m=()=>{if(!l||!i)return;requestAnimationFrame(m);const e=r.getValue();u(e)},u=e=>{i.fillStyle=`rgba(35, 45, 48, ${p.trigger?"0.2":"1"})`,i.fillRect(0,0,v,c);let t=e;if(p.trigger){let n=0;for(let t=1,s=e.length;t<s;t++)if(e[t]>p.level&&e[t-1]<p.level){n=t;break}n>0&&(t=e.slice(n)),i.beginPath();const s=_(p.level,[-1,1],[c-g,0+g],0);i.moveTo(0,s,0),i.lineTo(v,s),i.strokeStyle="rgba(255, 255, 0, 0.1)",i.lineWidth=3,i.stroke()}i.beginPath();for(let n=0,s=t.length;n<s;n++){const s=_(n,[0,e.length-1],[0,v],0),o=_(t[n],[-1,1],[c-g,0+g],0);0===n?i.moveTo(s,o):i.lineTo(s,o)}i.strokeStyle="white",i.lineWidth=2,i.stroke()};t((()=>{s(1,o.width=v,o),s(1,o.height=c,o),i=o.getContext("2d")}));return e.$$set=e=>{"state"in e&&s(0,p=e.state)},[p,o,r,e=>{e?(l=!0,m()):l=!1},()=>{s(0,p.trigger=!p.trigger,p)},function(e){__sv.binding_callbacks[e?"unshift":"push"]((()=>{o=e,s(1,o)}))},function(t){e.$$.not_equal(p.level,t)&&(p.level=t,s(0,p))}]}class v extends __sv.SvelteComponent{constructor(e){super(),__sv.init(this,e,a,l,__sv.safe_not_equal,{state:0},i)}}export{v as default};
